#! /usr/bin/python3

import config  # this is _NEEDED_, as it adds path
import datetime as dt
import ds

from ao_db import ao_db_fill


def ao_db_run( dest_l_choice  = 'USA'
             , dummy          = False
             , depth_max      = 2 ):
    """
    Acquires the flight info.

    :param dest_l_choice: choice of destination, one of 'all', 'USA', 'asia'
    :param dummy: whether one should insert into the database or not (run dummy)
    :param depth_max: how many intermediary airports one should check between each
                      airports given
    """

    # construct a set of already given pairs
    dest_l = {'all': ['JFK', 'LGA', 'EWR', 'SFO', 'LAX',
                      'BOS', 'FLL', 'MIA', 'DEN', 'ORD',
                      'HOU', 'IAH',
                      'ATL', 'DFW', 'CLT', 'LAS', 'PHX', 'SEA', 'MCO',
                      'MSP', 'DTW', 'PHL', 'BWI', 'DCA', 'MDW', 'SLC', 'IAD',
                      'SAN', 'HNL', 'TPA', 'PDX', 'DAL', 'STL', 'AUS', 'BNA', 'MSY',
                      'MCI', 'RDU', 'SNA', 'SJC', 'SMF', 'SJU', 'RSW', 'SAT', 'CLE',
                      'PIT', 'IND', 'CMH', 'MKE', 'BDL', 'MEX',  # up to here US
                      'PEK', 'DXB', 'HND', 'HKG', 'SIN', 'KUL',
                      'PVG', 'CGK', 'CAN', 'BKK', 'ICN', 'DEL',
                      'BOM', 'DEL', 'SHA', 'MNL', 'TPE', 'SZX', 'JED',
                      'CTU', 'KHI', 'KIX', 'GMP', 'HGH', 'CJU', 'SGN',
                      'THR', 'XIY', 'RUH', 'MAA',
                      # asia here
                      'LHR', 'CDG', 'IST', 'FRA', 'AMS', 'MAD', 'MUC', 'FCO',
                      'LGW', 'BCN', 'DME', 'SVO', 'ORY', 'AYT', 'CPH', 'ZRH',
                      'DUB', 'OSL', 'BRU', 'PMI', 'ARN', 'MAN', 'VIE', 'STN',
                      'DUS', 'TXL', 'LIS', 'MXP', 'ATH', 'HEL',
                      'VKO', 'GVA', 'HAM'  ]  # europe here
             , 'USA':  ['JFK', 'LGA', 'EWR',
                        'MIA', 'DEN', 'ORD',
                        'IAH',
                        'ATL', 'SAN']
             , 'asia': ['PEK', 'DXB', 'HND', 'HKG', 'SIN', 'KUL', 'PVG', 'CGK', 'CAN'] }

    ao_db_fill( ds.construct_date_range( dt.date.today() + dt.timedelta(days=2)
                                       , dt.date.today() + dt.timedelta(days=365) )
              , dest_l[dest_l_choice]
              , dummy     = dummy
              , depth_max = depth_max )


# main routine, repeat forever
while True:
    ao_db_run( dest_l_choice = 'USA'
             , depth_max     = 1 )  # 1 are direct flights only , 2 are in between flights
